<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/ruolin_bak.jpeg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/ruolin_bak.jpeg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Partition Table," />





  <link rel="alternate" href="/atom.xml" title="PostgreSQL 中文网" type="application/atom+xml" />






<meta name="description" content="在 PostgreSQL 中，分区表的使用并不像 oracle 那么智能， PostgreSQL 中是靠继承和触发器来实现分区表的，由于trigger 的使用，当业务繁忙时会大大降低数据库性能，所以 trigger 并不建议使用；因此 PostgreSQL 中的分区表对应用不再透明，例如，如果不使用 trigger，那么插入时程序需要指定子表等。今天测试了下取模分区的场景：以下为详细步骤 创建父表">
<meta name="keywords" content="Partition Table">
<meta property="og:type" content="article">
<meta property="og:title" content="PostgreSQL: 分区表应用之二(取模分区) ">
<meta property="og:url" content="https://postgres.fun/20120529163722.html">
<meta property="og:site_name" content="PostgreSQL 中文网">
<meta property="og:description" content="在 PostgreSQL 中，分区表的使用并不像 oracle 那么智能， PostgreSQL 中是靠继承和触发器来实现分区表的，由于trigger 的使用，当业务繁忙时会大大降低数据库性能，所以 trigger 并不建议使用；因此 PostgreSQL 中的分区表对应用不再透明，例如，如果不使用 trigger，那么插入时程序需要指定子表等。今天测试了下取模分区的场景：以下为详细步骤 创建父表">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-09-04T01:33:56.321Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PostgreSQL: 分区表应用之二(取模分区) ">
<meta name="twitter:description" content="在 PostgreSQL 中，分区表的使用并不像 oracle 那么智能， PostgreSQL 中是靠继承和触发器来实现分区表的，由于trigger 的使用，当业务繁忙时会大大降低数据库性能，所以 trigger 并不建议使用；因此 PostgreSQL 中的分区表对应用不再透明，例如，如果不使用 trigger，那么插入时程序需要指定子表等。今天测试了下取模分区的场景：以下为详细步骤 创建父表">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://postgres.fun/20120529163722.html"/>






  <title>PostgreSQL: 分区表应用之二(取模分区)  | PostgreSQL 中文网</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?848171401a55ef3f26344ab9bfebea10";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<p align="center" abcd </p>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PostgreSQL 中文网</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">francs's blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comments"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://postgres.fun/20120529163722.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="francs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/francs.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PostgreSQL 中文网">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PostgreSQL: 分区表应用之二(取模分区) </h1>
        

        <div class="post-meta">
	    
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-05-29T16:37:22+08:00">
                2012-05-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Postgres基础/" itemprop="url" rel="index">
                    <span itemprop="name">Postgres基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/20120529163722.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/20120529163722.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/20120529163722.html" class="leancloud_visitors" data-flag-title="PostgreSQL: 分区表应用之二(取模分区) ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在 PostgreSQL 中，分区表的使用并不像 oracle 那么智能， PostgreSQL 中是靠继承和触发器来实现分区表的，由于trigger 的使用，当业务繁忙时会大大降低数据库性能，所以 trigger 并不建议使用；因此 PostgreSQL 中的分区表对应用不再透明，例如，如果不使用 trigger，那么插入时程序需要指定子表等。今天测试了下取模分区的场景：以下为详细步骤</p>
<h1 id="创建父表"><a href="#创建父表" class="headerlink" title="创建父表"></a>创建父表</h1><p>创建父表并插入测试数据，如下:<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; create table tbl_name (id int4 primary key,name varchar(<span class="number">32</span>),remark varchar(<span class="number">64</span>));  </span><br><span class="line">NOTICE: CREATE TABLE / PRIMARY KEY will create implicit index <span class="string">"tbl_name_pkey"</span> <span class="keyword">for</span> table <span class="string">"tbl_name"</span>  </span><br><span class="line">CREATE TABLE</span><br><span class="line"></span><br><span class="line">francs=&gt; insert into tbl_name select generate_series(<span class="number">1</span>,<span class="number">20000000</span>),generate_series(<span class="number">1</span>,<span class="number">20000000</span>) |<span class="type">| '_a</span>','<span class="number">0</span>';  </span><br><span class="line">INSERT <span class="number">0</span> <span class="number">20000000</span></span><br><span class="line"></span><br><span class="line">francs=&gt; select * from tbl_name limit <span class="number">10</span>;  </span><br><span class="line">id | <span class="type">name</span> | <span class="type">remark</span>  </span><br><span class="line">----+------+--------  </span><br><span class="line"> <span class="number">1</span> | <span class="type">1_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">2</span> | <span class="type">2_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">3</span> | <span class="type">3_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">4</span> | <span class="type">4_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">5</span> | <span class="type">5_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">6</span> | <span class="type">6_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">7</span> | <span class="type">7_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">8</span> | <span class="type">8_a</span> | <span class="type">0</span>  </span><br><span class="line"> <span class="number">9</span> | <span class="type">9_a</span> | <span class="type">0</span>  </span><br><span class="line"><span class="number">10</span> | <span class="type">10_a</span> | <span class="type">0</span>  </span><br><span class="line">(<span class="number">10</span> rows)</span><br><span class="line"></span><br><span class="line">francs=&gt; create unique index concurrently idx_tbl_name_name on tbl_name <span class="built_in">using</span> btree (name);  </span><br><span class="line">CREATE INDEX</span><br><span class="line"></span><br><span class="line">francs=&gt; \d tbl_name  </span><br><span class="line"> <span class="keyword">Table</span> <span class="string">"francs.tbl_name"</span>  </span><br><span class="line">Column | <span class="type">Type</span> | <span class="type">Modifiers</span>  </span><br><span class="line">--------+-----------------------+-----------  </span><br><span class="line">id | <span class="type">integer</span> | <span class="type">not</span> null  </span><br><span class="line">name | <span class="type">character</span> varying(<span class="number">32</span>) |  <span class="type"></span></span><br><span class="line"><span class="type">remark</span> | <span class="type">character</span> varying(<span class="number">64</span>) |  <span class="type"></span></span><br><span class="line"><span class="type">Indexes</span>:  </span><br><span class="line"> <span class="string">"tbl_name_pkey"</span> PRIMARY KEY, btree (id)  </span><br><span class="line"> <span class="string">"idx_tbl_name_name"</span> UNIQUE, btree (name)</span><br></pre></td></tr></table></figure></p>
<p>父表备份<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; <span class="keyword">create</span> table tbl_name_old <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> tbl_name;  </span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">20000000</span></span><br><span class="line"></span><br><span class="line">francs=&gt; <span class="keyword">alter</span> table tbl_name_old add <span class="keyword">primary</span> <span class="keyword">key</span>(id);  </span><br><span class="line">NOTICE: ALTER TABLE / ADD PRIMARY KEY will <span class="keyword">create</span> implicit <span class="keyword">index</span> <span class="string">"tbl_name_old_pkey"</span> <span class="keyword">for</span> table <span class="string">"tbl_name_old"</span>  </span><br><span class="line"><span class="keyword">ALTER</span> TABLE</span><br><span class="line"></span><br><span class="line">francs=&gt; <span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> concurrently idx_tbl_name_old_name <span class="keyword">on</span> tbl_name_old <span class="keyword">using</span> btree (name);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span></span><br></pre></td></tr></table></figure></p>
<p>备注：这里备份父表，用于之后做性能比较，因为分表后 tbl_name 数据要清空。</p>
<h1 id="创建子表"><a href="#创建子表" class="headerlink" title="创建子表"></a>创建子表</h1><p>创建子表， 分区字段 id，如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_0 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_1 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_2 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_3 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_4 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_5 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_6 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_7 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_8 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_9 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_10 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_11 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_12 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_13 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_14 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_15 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_16 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_17 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_18 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_19 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_20 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_21 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_22 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_23 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_24 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_25 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_26 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_27 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_28 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_29 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_30 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_name_31 ( <span class="keyword">like</span> tbl_name <span class="keyword">including</span> <span class="keyword">constraints</span> <span class="keyword">including</span> <span class="keyword">defaults</span> <span class="keyword">INCLUDING</span> COMMENTS ) inherits ( tbl_name );</span><br></pre></td></tr></table></figure></p>
<p>备注：创建子表时这里没有继承 index，是因为先创建索引再导数据速度会比较慢；</p>
<h1 id="将数据分发到子表"><a href="#将数据分发到子表" class="headerlink" title="将数据分发到子表"></a>将数据分发到子表</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_0 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">0</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_1 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">1</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_2 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">2</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_3 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">3</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_4 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">4</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_5 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">5</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_6 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">6</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_7 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">7</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_8 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">8</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_9 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">9</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_10 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">10</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_11 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">11</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_12 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">12</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_13 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">13</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_14 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">14</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_15 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">15</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_16 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">16</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_17 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">17</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_18 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">18</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_19 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">19</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_20 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">20</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_21 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">21</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_22 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">22</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_23 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">23</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_24 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">24</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_25 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">25</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_26 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">26</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_27 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">27</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_28 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">28</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_29 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">29</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_30 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">30</span>;  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tbl_name_31 <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">only</span> tbl_name <span class="keyword">where</span> <span class="keyword">mod</span>(<span class="keyword">id</span>,<span class="number">32</span>) =<span class="number">31</span>;</span><br></pre></td></tr></table></figure>
<h1 id="创建子表约束"><a href="#创建子表约束" class="headerlink" title="创建子表约束"></a>创建子表约束</h1><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">alter table tbl_name_0<span class="built_in"> add </span>CONSTRAINT con_tbl_name_0<span class="built_in"> check </span>( mod(id,32) =0);  </span><br><span class="line">alter table tbl_name_1<span class="built_in"> add </span>CONSTRAINT con_tbl_name_1<span class="built_in"> check </span>( mod(id,32) =1);  </span><br><span class="line">alter table tbl_name_2<span class="built_in"> add </span>CONSTRAINT con_tbl_name_2<span class="built_in"> check </span>( mod(id,32) =2);  </span><br><span class="line">alter table tbl_name_3<span class="built_in"> add </span>CONSTRAINT con_tbl_name_3<span class="built_in"> check </span>( mod(id,32) =3);  </span><br><span class="line">alter table tbl_name_4<span class="built_in"> add </span>CONSTRAINT con_tbl_name_4<span class="built_in"> check </span>( mod(id,32) =4);  </span><br><span class="line">alter table tbl_name_5<span class="built_in"> add </span>CONSTRAINT con_tbl_name_5<span class="built_in"> check </span>( mod(id,32) =5);  </span><br><span class="line">alter table tbl_name_6<span class="built_in"> add </span>CONSTRAINT con_tbl_name_6<span class="built_in"> check </span>( mod(id,32) =6);  </span><br><span class="line">alter table tbl_name_7<span class="built_in"> add </span>CONSTRAINT con_tbl_name_7<span class="built_in"> check </span>( mod(id,32) =7);  </span><br><span class="line">alter table tbl_name_8<span class="built_in"> add </span>CONSTRAINT con_tbl_name_8<span class="built_in"> check </span>( mod(id,32) =8);  </span><br><span class="line">alter table tbl_name_9<span class="built_in"> add </span>CONSTRAINT con_tbl_name_9<span class="built_in"> check </span>( mod(id,32) =9);  </span><br><span class="line">alter table tbl_name_10<span class="built_in"> add </span>CONSTRAINT con_tbl_name_10<span class="built_in"> check </span>( mod(id,32) =10);  </span><br><span class="line">alter table tbl_name_11<span class="built_in"> add </span>CONSTRAINT con_tbl_name_11<span class="built_in"> check </span>( mod(id,32) =11);  </span><br><span class="line">alter table tbl_name_12<span class="built_in"> add </span>CONSTRAINT con_tbl_name_12<span class="built_in"> check </span>( mod(id,32) =12);  </span><br><span class="line">alter table tbl_name_13<span class="built_in"> add </span>CONSTRAINT con_tbl_name_13<span class="built_in"> check </span>( mod(id,32) =13);  </span><br><span class="line">alter table tbl_name_14<span class="built_in"> add </span>CONSTRAINT con_tbl_name_14<span class="built_in"> check </span>( mod(id,32) =14);  </span><br><span class="line">alter table tbl_name_15<span class="built_in"> add </span>CONSTRAINT con_tbl_name_15<span class="built_in"> check </span>( mod(id,32) =15);</span><br><span class="line">alter table tbl_name_16<span class="built_in"> add </span>CONSTRAINT con_tbl_name_16<span class="built_in"> check </span>( mod(id,32) =16);  </span><br><span class="line">alter table tbl_name_17<span class="built_in"> add </span>CONSTRAINT con_tbl_name_17<span class="built_in"> check </span>( mod(id,32) =17);  </span><br><span class="line">alter table tbl_name_18<span class="built_in"> add </span>CONSTRAINT con_tbl_name_18<span class="built_in"> check </span>( mod(id,32) =18);  </span><br><span class="line">alter table tbl_name_19<span class="built_in"> add </span>CONSTRAINT con_tbl_name_19<span class="built_in"> check </span>( mod(id,32) =19);  </span><br><span class="line">alter table tbl_name_20<span class="built_in"> add </span>CONSTRAINT con_tbl_name_20<span class="built_in"> check </span>( mod(id,32) =20);  </span><br><span class="line">alter table tbl_name_21<span class="built_in"> add </span>CONSTRAINT con_tbl_name_21<span class="built_in"> check </span>( mod(id,32) =21);  </span><br><span class="line">alter table tbl_name_22<span class="built_in"> add </span>CONSTRAINT con_tbl_name_22<span class="built_in"> check </span>( mod(id,32) =22);  </span><br><span class="line">alter table tbl_name_23<span class="built_in"> add </span>CONSTRAINT con_tbl_name_23<span class="built_in"> check </span>( mod(id,32) =23);  </span><br><span class="line">alter table tbl_name_24<span class="built_in"> add </span>CONSTRAINT con_tbl_name_24<span class="built_in"> check </span>( mod(id,32) =24);  </span><br><span class="line">alter table tbl_name_25<span class="built_in"> add </span>CONSTRAINT con_tbl_name_25<span class="built_in"> check </span>( mod(id,32) =25);  </span><br><span class="line">alter table tbl_name_26<span class="built_in"> add </span>CONSTRAINT con_tbl_name_26<span class="built_in"> check </span>( mod(id,32) =26);  </span><br><span class="line">alter table tbl_name_27<span class="built_in"> add </span>CONSTRAINT con_tbl_name_27<span class="built_in"> check </span>( mod(id,32) =27);  </span><br><span class="line">alter table tbl_name_28<span class="built_in"> add </span>CONSTRAINT con_tbl_name_28<span class="built_in"> check </span>( mod(id,32) =28);  </span><br><span class="line">alter table tbl_name_29<span class="built_in"> add </span>CONSTRAINT con_tbl_name_29<span class="built_in"> check </span>( mod(id,32) =29);  </span><br><span class="line">alter table tbl_name_30<span class="built_in"> add </span>CONSTRAINT con_tbl_name_30<span class="built_in"> check </span>( mod(id,32) =30);  </span><br><span class="line">alter table tbl_name_31<span class="built_in"> add </span>CONSTRAINT con_tbl_name_31<span class="built_in"> check </span>( mod(id,32) =31);</span><br></pre></td></tr></table></figure>
<h1 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h1><p>增加主键，如下<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_0 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_0 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_1 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_1 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_2 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_2 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_3 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_3 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_4 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_4 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_5 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_5 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_6 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_6 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_7 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_7 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_8 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_8 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_9 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_9 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_10 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_10 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_11 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_11 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_12 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_12 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_13 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_13 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_14 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_14 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_15 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_15 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_16 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_16 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_17 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_17 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_18 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_18 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_19 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_19 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_20 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_20 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_21 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_21 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_22 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_22 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_23 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_23 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_24 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_24 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_25 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_25 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_26 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_26 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_27 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_27 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_28 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_28 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_29 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_29 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_30 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_30 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);  </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name_31 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_tbl_name_id_31 PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure></p>
<p>创建 unique 索引<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_0 <span class="keyword">ON</span> tbl_name_0 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_1 <span class="keyword">ON</span> tbl_name_1 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_2 <span class="keyword">ON</span> tbl_name_2 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_3 <span class="keyword">ON</span> tbl_name_3 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_4 <span class="keyword">ON</span> tbl_name_4 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_5 <span class="keyword">ON</span> tbl_name_5 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_6 <span class="keyword">ON</span> tbl_name_6 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_7 <span class="keyword">ON</span> tbl_name_7 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_8 <span class="keyword">ON</span> tbl_name_8 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_9 <span class="keyword">ON</span> tbl_name_9 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_10 <span class="keyword">ON</span> tbl_name_10 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_11 <span class="keyword">ON</span> tbl_name_11 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_12 <span class="keyword">ON</span> tbl_name_12 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_13 <span class="keyword">ON</span> tbl_name_13 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_14 <span class="keyword">ON</span> tbl_name_14 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_15 <span class="keyword">ON</span> tbl_name_15 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_16 <span class="keyword">ON</span> tbl_name_16 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_17 <span class="keyword">ON</span> tbl_name_17 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_18 <span class="keyword">ON</span> tbl_name_18 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_19 <span class="keyword">ON</span> tbl_name_19 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_20 <span class="keyword">ON</span> tbl_name_20 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_21 <span class="keyword">ON</span> tbl_name_21 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_22 <span class="keyword">ON</span> tbl_name_22 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_23 <span class="keyword">ON</span> tbl_name_23 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_24 <span class="keyword">ON</span> tbl_name_24 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_25 <span class="keyword">ON</span> tbl_name_25 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_26 <span class="keyword">ON</span> tbl_name_26 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_27 <span class="keyword">ON</span> tbl_name_27 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_28 <span class="keyword">ON</span> tbl_name_28 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_29 <span class="keyword">ON</span> tbl_name_29 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_30 <span class="keyword">ON</span> tbl_name_30 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> idx_tbl_name_name_31 <span class="keyword">ON</span> tbl_name_31 <span class="keyword">USING</span> btree (<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<h1 id="清空父表数据"><a href="#清空父表数据" class="headerlink" title="清空父表数据"></a>清空父表数据</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> <span class="keyword">only</span> tbl_name;</span><br></pre></td></tr></table></figure>
<h1 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h1><p>查看参数 constraint_exclusion<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; <span class="built_in">show</span> constraint_exclusion;  </span><br><span class="line">constraint_exclusion  </span><br><span class="line">----------------------  </span><br><span class="line"><span class="built_in">partition</span>  </span><br><span class="line">(<span class="number">1</span> <span class="built_in">row</span>)</span><br></pre></td></tr></table></figure></p>
<p>显示查询父表的PLAN<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">francs</span>=&gt; explain select id,name,remark <span class="keyword">from</span> tbl_name where id =32 ;  </span><br><span class="line"> QUERY PLAN  </span><br><span class="line">-----------------------------------------------------------------------------------------------------------  </span><br><span class="line">Result (<span class="attribute">cost</span>=0.00..73.11 <span class="attribute">rows</span>=33 <span class="attribute">width</span>=16)  </span><br><span class="line"> -&gt; Append (<span class="attribute">cost</span>=0.00..73.11 <span class="attribute">rows</span>=33 <span class="attribute">width</span>=16)  </span><br><span class="line"> -&gt; Seq Scan on tbl_name (<span class="attribute">cost</span>=0.00..0.00 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Filter: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_0 on tbl_name_0 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_1 on tbl_name_1 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_2 on tbl_name_2 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_3 on tbl_name_3 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_4 on tbl_name_4 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_5 on tbl_name_5 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_6 on tbl_name_6 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_7 on tbl_name_7 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_8 on tbl_name_8 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_9 on tbl_name_9 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_10 on tbl_name_10 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_11 on tbl_name_11 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_12 on tbl_name_12 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_13 on tbl_name_13 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_14 on tbl_name_14 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_15 on tbl_name_15 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_16 on tbl_name_16 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_17 on tbl_name_17 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_18 on tbl_name_18 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_19 on tbl_name_19 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_20 on tbl_name_20 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_21 on tbl_name_21 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_22 on tbl_name_22 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_23 on tbl_name_23 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_24 on tbl_name_24 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_25 on tbl_name_25 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_26 on tbl_name_26 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_27 on tbl_name_27 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_28 on tbl_name_28 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_29 on tbl_name_29 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_30 on tbl_name_30 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_31 on tbl_name_31 tbl_name (<span class="attribute">cost</span>=0.00..2.28 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line">(68 rows)</span><br></pre></td></tr></table></figure></p>
<p>备注：查询父表时，扫描了所有分区。</p>
<p>修改SQL，再次显示PLAN<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">francs</span>=&gt; explain select id,name,remark <span class="keyword">from</span> tbl_name where mod(id,32)=0 <span class="keyword">and</span> id =32 ;  </span><br><span class="line"> QUERY PLAN  </span><br><span class="line">---------------------------------------------------------------------------------------------------------  </span><br><span class="line">Result (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=2 <span class="attribute">width</span>=16)  </span><br><span class="line"> -&gt; Append (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=2 <span class="attribute">width</span>=16)  </span><br><span class="line"> -&gt; Seq Scan on tbl_name (<span class="attribute">cost</span>=0.00..0.00 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Filter: ((id = 32) <span class="keyword">AND</span> (mod(id, 32) = 0))  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_0 on tbl_name_0 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line">(7 rows)</span><br></pre></td></tr></table></figure></p>
<p>备注：查询父表时，如果加上 “where mod(id,32)= ? “时，不再扫描所有分区，而只扫描一个分区。</p>
<p>关闭 constraint_exclusion 参数，再次查看 PALN<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">francs</span>=&gt; <span class="builtin-name">set</span> <span class="attribute">constraint_exclusion</span>=off;  </span><br><span class="line">SET</span><br><span class="line"><span class="attribute">francs</span>=&gt; explain select id,name,remark <span class="keyword">from</span> tbl_name where mod(id,32)=0 <span class="keyword">and</span> id =32 ;  </span><br><span class="line"> QUERY PLAN  </span><br><span class="line">-----------------------------------------------------------------------------------------------------------  </span><br><span class="line">Result (<span class="attribute">cost</span>=0.00..73.27 <span class="attribute">rows</span>=33 <span class="attribute">width</span>=16)  </span><br><span class="line"> -&gt; Append (<span class="attribute">cost</span>=0.00..73.27 <span class="attribute">rows</span>=33 <span class="attribute">width</span>=16)  </span><br><span class="line"> -&gt; Seq Scan on tbl_name (<span class="attribute">cost</span>=0.00..0.00 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Filter: ((id = 32) <span class="keyword">AND</span> (mod(id, 32) = 0))  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_0 on tbl_name_0 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_1 on tbl_name_1 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_2 on tbl_name_2 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_3 on tbl_name_3 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_4 on tbl_name_4 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_5 on tbl_name_5 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_6 on tbl_name_6 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_7 on tbl_name_7 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_8 on tbl_name_8 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_9 on tbl_name_9 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_10 on tbl_name_10 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_11 on tbl_name_11 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_12 on tbl_name_12 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_13 on tbl_name_13 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_14 on tbl_name_14 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_15 on tbl_name_15 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_16 on tbl_name_16 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_17 on tbl_name_17 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_18 on tbl_name_18 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_19 on tbl_name_19 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_20 on tbl_name_20 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_21 on tbl_name_21 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_22 on tbl_name_22 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_23 on tbl_name_23 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_24 on tbl_name_24 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_25 on tbl_name_25 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_26 on tbl_name_26 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_27 on tbl_name_27 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_28 on tbl_name_28 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_29 on tbl_name_29 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_30 on tbl_name_30 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line"> -&gt; Index Scan using pk_tbl_name_id_31 on tbl_name_31 tbl_name (<span class="attribute">cost</span>=0.00..2.29 <span class="attribute">rows</span>=1 <span class="attribute">width</span>=16)  </span><br><span class="line"> Index Cond: (id = 32)  </span><br><span class="line"> Filter: (mod(id, 32) = 0)  </span><br><span class="line">(100 rows)</span><br></pre></td></tr></table></figure></p>
<p>备注： 关闭 constraint_exclusion 参数后，即扫描所有分区，关于这个参数的作用可以参考本文末尾的附录。</p>
<h1 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h1><p>下面测试两种场景：</p>
<ul>
<li>场景一: 根据分区字段 id 查询测试</li>
<li>场景二: 根据非分区字段 name 查询测试</li>
</ul>
<h2 id="根据分区字段-id-查询测试"><a href="#根据分区字段-id-查询测试" class="headerlink" title="根据分区字段 id 查询测试"></a>根据分区字段 id 查询测试</h2><p>分表前查询<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; select id,name,remark from tbl_name_old where id =128 ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">-----+-------+--------  </span><br><span class="line">128 | 128_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.305 ms  </span><br><span class="line"></span><br><span class="line">francs=&gt; select id,name,remark from tbl_name_old where id =128 ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">-----+-------+--------  </span><br><span class="line">128 | 128_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.277 ms  </span><br><span class="line"></span><br><span class="line">francs=&gt; select id,name,remark from tbl_name_old where id =128 ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">-----+-------+--------  </span><br><span class="line">128 | 128_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.351 ms</span><br></pre></td></tr></table></figure></p>
<p>分表后查询<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; select id,name,remark from tbl_name_0 where id =64 ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">64 | 64_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.331 ms  </span><br><span class="line"></span><br><span class="line">francs=&gt; select id,name,remark from tbl_name_0 where id =64 ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">64 | 64_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.322 ms  </span><br><span class="line"></span><br><span class="line">francs=&gt; select id,name,remark from tbl_name_0 where id =64 ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">64 | 64_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.301 ms</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th style="text-align:center">skyid 测试</th>
<th style="text-align:center">测试一</th>
<th style="text-align:center">测试二</th>
<th style="text-align:center">测试三</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">分表前</td>
<td style="text-align:center">0.305 ms</td>
<td style="text-align:center">0.277 ms</td>
<td style="text-align:center">0.351 ms</td>
</tr>
<tr>
<td style="text-align:center">分表后</td>
<td style="text-align:center">0.331 ms</td>
<td style="text-align:center">0.322 ms</td>
<td style="text-align:center">0.301 ms</td>
</tr>
</tbody>
</table>
<p>备注：分表后，这里建议应用程序根据 id 取模，然后直接定位子表查询，这里数据来看，性能无明显变化，数据量大的时候分表后的这种场景性能有小辐上升。</p>
<h2 id="根据非分区字段-name-查询测试"><a href="#根据非分区字段-name-查询测试" class="headerlink" title="根据非分区字段 name 查询测试"></a>根据非分区字段 name 查询测试</h2><p>分表前<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; select id,name,remark from tbl_name_old where name='32_a' ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">32 | 32_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.466 ms  </span><br><span class="line">francs=&gt; select id,name,remark from tbl_name_old where name='32_a' ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">32 | 32_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.348 ms  </span><br><span class="line">francs=&gt; select id,name,remark from tbl_name_old where name='32_a' ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">32 | 32_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 0.326 ms</span><br></pre></td></tr></table></figure></p>
<p>分表后<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">francs=&gt; select id,name,remark from tbl_name where name='32_a' ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">32 | 32_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 1.587 ms  </span><br><span class="line"></span><br><span class="line">francs=&gt; select id,name,remark from tbl_name where name='32_a' ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">32 | 32_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 1.478 ms  </span><br><span class="line"></span><br><span class="line">francs=&gt; select id,name,remark from tbl_name where name='32_a' ;  </span><br><span class="line">id | name | remark  </span><br><span class="line">----+------+--------  </span><br><span class="line">32 | 32_a | 0  </span><br><span class="line">(1 row)</span><br><span class="line"><span class="keyword">Time:</span> 2.227 ms</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th style="text-align:center">name 测试</th>
<th style="text-align:center">测试一</th>
<th style="text-align:center">测试二</th>
<th style="text-align:center">测试三</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">分表前</td>
<td style="text-align:center">0.466 ms</td>
<td style="text-align:center">0.348 ms</td>
<td style="text-align:center">0.326 ms</td>
</tr>
<tr>
<td style="text-align:center">分表后</td>
<td style="text-align:center">1.587 ms</td>
<td style="text-align:center">1.478 ms</td>
<td style="text-align:center">2.227 ms</td>
</tr>
</tbody>
</table>
<p>备注：根据非分区字段查询，分表后由于需要扫描所有分区，性能有下降辐度较大。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>pg 中的表分区后，如果根据 “ where 分区键= ？” 查询，如果扫描父表，性能降低!  </li>
<li>pg 中的表分区后，如果根据 “ where 分区键= ？” 查询，如果程序定位到子表，性能小辐度上升!  </li>
<li>pg 中的表分区后，如果根据 “ where 非分区键= ？” 查询，且非分区键有索引，性能大辐下降。  </li>
<li>pg 中的表分区后，非分区字段的唯一性无法保证。</li>
<li>PG 中的表分区后，为后期的分库奠定了基础。</li>
</ol>
<p>备注：签于以上特点，故业务表分区需要权衡各方面的利弊，例如如果应用 90% 以上都是根据分区键查询，则建议分区。</p>
<h1 id="附"><a href="#附" class="headerlink" title="附"></a>附</h1><blockquote>
<p>constraint_exclusion (enum)<br> Controls the query planner is use of table constraints to optimize queries. The allowed values of constraint_exclusion are on (examine constraints for all tables), off (never examine constraints), and partition (examine constraints only for inheritance child tables and UNION ALL subqueries). partition is the default setting. It is often used with inheritance and partitioned tables to improve performance.</p>
</blockquote>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">

<div>
<p style="text-align:left">最后推荐和张文升共同编写的《PostgreSQL实战》，本书基于PostgreSQL 10 编写，共18章，重点介绍SQL高级特性、并行查询、分区表、物理复制、逻辑复制、备份恢复、高可用、性能优化、PostGIS等，涵盖大量实战用例！</p>
<p style="text-align:left">购买链接：<a href="https://item.jd.com/12405774.html">https://item.jd.com/12405774.html</a></p>
<img src="/images/PostgreSQL实战_small.png" alt="PostgreSQL实战" style="margin: 0 auto;" />
</div>


<div>感谢支持！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/webchat.jpg" alt="francs 微信支付"/>
        <p>微信支付</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    francs
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://postgres.fun/20120529163722.html" title="PostgreSQL: 分区表应用之二(取模分区) ">https://postgres.fun/20120529163722.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="external nofollow" target="_blank">CC BY-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Partition-Table/" rel="tag"># Partition Table</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/20120525145255.html" rel="next" title="PostgreSQL9.2Beta: Add CONCURRENTLY option to DROP INDEX CONCURRENTLY ">
                <i class="fa fa-chevron-left"></i> PostgreSQL9.2Beta: Add CONCURRENTLY option to DROP INDEX CONCURRENTLY 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/20120529211611.html" rel="prev" title="PostgreSQL9.2Beta: Add a deadlock counter to the pg_stat_database system view ">
                PostgreSQL9.2Beta: Add a deadlock counter to the pg_stat_database system view  <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/francs.png"
                alt="francs" />
            
              <p class="site-author-name" itemprop="name">francs</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">549</span>
                  <span class="site-state-item-name">文章</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">55</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/francs" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/527628/francs" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/1992989604" target="_blank" title="新浪微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>新浪微博</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/francs-tan-13903832/" target="_blank" title="Linkedin">
                      
                        <i class="fa fa-fw fa-linkedin"></i>Linkedin</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.postgres.cn" title="PostgreSQL中文社区" target="_blank">PostgreSQL中文社区</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.postgresql.org" title="PostgreSQL官网" target="_blank">PostgreSQL官网</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://dba.stackexchange.com" title="DBA.stackexchange" target="_blank">DBA.stackexchange</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://momjian.us/main/blogs/pgblog/2012.html" title="Bruce momjian's blog" target="_blank">Bruce momjian's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.depesz.com" title="depesz's blog" target="_blank">depesz's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://paquier.xyz" title="Michael Paquier's blog" target="_blank">Michael Paquier's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/digoal/blog/blob/master/README.md" title="德哥博客" target="_blank">德哥博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.163.com/li_hx" title="那海蓝蓝" target="_blank">那海蓝蓝</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.osdba.net" title="Osdba's blog" target="_blank">Osdba's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://my.oschina.net/Kenyon" title="Kenyon's blog" target="_blank">Kenyon's blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lruihao.cn" title="博採眾長" target="_blank">博採眾長</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://dazuiba.skymobi.cn/" title="魂醉" target="_blank">魂醉</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#创建父表"><span class="nav-number">1.</span> <span class="nav-text">创建父表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建子表"><span class="nav-number">2.</span> <span class="nav-text">创建子表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#将数据分发到子表"><span class="nav-number">3.</span> <span class="nav-text">将数据分发到子表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建子表约束"><span class="nav-number">4.</span> <span class="nav-text">创建子表约束</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建索引"><span class="nav-number">5.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#清空父表数据"><span class="nav-number">6.</span> <span class="nav-text">清空父表数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#执行计划"><span class="nav-number">7.</span> <span class="nav-text">执行计划</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#性能测试"><span class="nav-number">8.</span> <span class="nav-text">性能测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#根据分区字段-id-查询测试"><span class="nav-number">8.1.</span> <span class="nav-text">根据分区字段 id 查询测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据非分区字段-name-查询测试"><span class="nav-number">8.2.</span> <span class="nav-text">根据非分区字段 name 查询测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">9.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附"><span class="nav-number">10.</span> <span class="nav-text">附</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">francs</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>





  <span class="post-meta-divider">|</span>




  #<div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>






        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info//busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 博客访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 博客访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>

<div >

<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010402003707" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="/images/gongan.png" style="float:left;"/>浙公网安备 33010402003707号</p></a><span class="post-meta-divider">|</span><span><a href="http://www.miitbeian.gov.cn">浙ICP备18045927号</a></span>

</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'UK8DCa4kSCj0Th48U4nGPxrO-gzGzoHsz',
        appKey: 'gxPalmYtqejoIqRUifA1Lqg6',
        placeholder: '留言',
        avatar:'',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'manual') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("UK8DCa4kSCj0Th48U4nGPxrO-gzGzoHsz", "gxPalmYtqejoIqRUifA1Lqg6");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
